{"version":3,"sources":["../src/app.ts","../src/utils/utils.ts","../src/schemas/encryptionOptions.schema.ts"],"sourcesContent":["import { createCipheriv, randomBytes, scryptSync, createDecipheriv } from 'crypto';\nimport { type IEncryptionReturn, EncryptionOptionsInput, DecryptionOptionsInput } from '@/types';\nimport { isValidPayload } from '@/utils';\nimport { CryptographyOptionsSchema } from '@/schemas/encryptionOptions.schema';\n\n/**\n * Encrypts a given payload using the provided encryption or the default is 'AES-256-CBC'.\n * @param {string} payload - The string to be encrypted.\n * @returns {object} An object containing the encrypted value and initialization vector (iv).\n */\n\nexport function encrypt(payload: string, options: EncryptionOptionsInput): IEncryptionReturn {\n\ttry {\n\t\t// Inject discriminator\n\t\tconst mergedOptions = {\n\t\t\t...options,\n\t\t\ttype: 'encryption',\n\t\t} as const;\n\n\t\tconst isValid = isValidPayload({\n\t\t\tschema: CryptographyOptionsSchema,\n\t\t\tpayload: mergedOptions,\n\t\t\tincludeLogs: mergedOptions.includeLogs,\n\t\t});\n\t\tif (!isValid.success) throw new Error('There was an error on the arguments');\n\n\t\tconst algorithm = mergedOptions.algorithm || 'aes-256-cbc';\n\t\tconst encodingInput = mergedOptions.encodingInput || 'utf8';\n\t\tconst encodingOutput = mergedOptions.encodingOutput || 'hex';\n\t\tconst keyLength = mergedOptions.keyLength || 32; // Default key length for AES-256\n\t\tconst ivSize = mergedOptions.ivSize || 16;\n\n\t\tconst key = scryptSync(mergedOptions.password, mergedOptions.salt, keyLength);\n\t\tconst iv = randomBytes(ivSize);\n\n\t\tconst cipher = createCipheriv(algorithm, key, iv);\n\t\tlet encrypted = cipher.update(payload, encodingInput, encodingOutput);\n\t\tencrypted += cipher.final(encodingOutput);\n\n\t\treturn {\n\t\t\tmessage: 'Encrypted successfully',\n\t\t\tiv: iv.toString(encodingOutput),\n\t\t\tvalue: encrypted,\n\t\t};\n\t} catch (err) {\n\t\tconst message = err instanceof Error ? `Error encrypting data ${err.message}` : 'Unknown error';\n\t\tconsole.error(message);\n\t\tthrow new Error(message);\n\t}\n}\n\nexport function decrypt(payload: string, iv: string, options: DecryptionOptionsInput) {\n\ttry {\n\t\t// Inject discriminator\n\t\tconst mergedOptions = {\n\t\t\t...options,\n\t\t\ttype: 'decryption',\n\t\t} as const;\n\n\t\t// Validation\n\t\tconst isValid = isValidPayload({\n\t\t\tschema: CryptographyOptionsSchema,\n\t\t\tpayload: mergedOptions,\n\t\t\tincludeLogs: mergedOptions.includeLogs,\n\t\t});\n\t\tif (!isValid.success) throw new Error('There was an error on the arguments');\n\n\t\tconst algorithm = mergedOptions.algorithm || 'aes-256-cbc';\n\t\tconst password = mergedOptions.password;\n\t\tconst salt = mergedOptions.salt;\n\t\tconst keyLength = mergedOptions.keyLength || 32;\n\t\tconst encodingInput = mergedOptions.encodingInput || 'hex';\n\t\tconst encodingOutput = mergedOptions.encodingOutput || 'utf8';\n\n\t\tconst key = scryptSync(password, salt, keyLength);\n\t\tconst bufferedIv = Buffer.from(iv, encodingInput);\n\n\t\tconst decipher = createDecipheriv(algorithm, key, bufferedIv);\n\t\tlet decrypted = decipher.update(payload, encodingInput, encodingOutput);\n\t\tdecrypted += decipher.final(encodingOutput);\n\n\t\treturn decrypted;\n\t} catch (err) {\n\t\tconst message =\n\t\t\terr instanceof Error\n\t\t\t\t? `Error decrypting data. Check the salt or password: ${err.message}`\n\t\t\t\t: 'Unknown error';\n\t\tconsole.error(message);\n\t\tthrow new Error(message);\n\t}\n}\n","import { type IValidatePayloadParams } from '@/types';\n\nconst isValidPayload = <T>(params: IValidatePayloadParams<T>) => {\n\tconst result = params.schema.safeParse(params.payload);\n\n\tif (!result.success) {\n\t\tconst errorObj = {\n\t\t\tsuccess: result.success,\n\t\t\terrors: result.error.issues.map((el) => {\n\t\t\t\treturn {\n\t\t\t\t\tmessage: el.message,\n\t\t\t\t\tpath: el.path,\n\t\t\t\t};\n\t\t\t}),\n\t\t};\n\t\tif (params.includeLogs) console.dir(errorObj, { depth: null });\n\t\treturn errorObj;\n\t}\n\tif (params.includeLogs) console.log('result', result);\n\treturn { success: result.success, data: result.data };\n};\n\nexport { isValidPayload };\n","import z from 'zod';\n\nconst BaseCryptographyOptions = z.object({\n\talgorithm: z.string().trim().optional(),\n\tpassword: z.string().trim().nonempty('Password is required').min(24, 'Password must be minimum of 24 characters'),\n\tsalt: z.string().trim().nonempty('salt is required').min(16, 'salt must be minimum of 16 characters'),\n\tkeyLength: z.number().optional(),\n\tivSize: z.number().optional(),\n\tincludeLogs: z.boolean().default(false).optional(),\n});\n\n// Encryption options schema\nconst EncryptionOptions = BaseCryptographyOptions.extend({\n\ttype: z.literal('encryption'),\n\tencodingInput: z.literal('utf8').optional(),\n\tencodingOutput: z.enum(['hex', 'base64']).optional(),\n});\n\n// Decryption options schema\nconst DecryptionOptions = BaseCryptographyOptions.extend({\n\ttype: z.literal('decryption'),\n\tencodingInput: z.enum(['hex', 'base64']).optional(),\n\tencodingOutput: z.literal('utf8').optional(),\n});\n\n// Discriminated union\nconst CryptographyOptionsSchema = z.discriminatedUnion('type', [EncryptionOptions, DecryptionOptions]);\n\nexport { CryptographyOptionsSchema, EncryptionOptions, DecryptionOptions };\n"],"mappings":";i5BAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,aAAAE,EAAA,YAAAC,IAAA,eAAAC,EAAAJ,GAAA,IAAAK,EAA0E,kBCE1E,IAAMC,EAAqBC,GAAsC,CAChE,IAAMC,EAASD,EAAO,OAAO,UAAUA,EAAO,OAAO,EAErD,GAAI,CAACC,EAAO,QAAS,CACpB,IAAMC,EAAW,CAChB,QAASD,EAAO,QAChB,OAAQA,EAAO,MAAM,OAAO,IAAKE,IACzB,CACN,QAASA,EAAG,QACZ,KAAMA,EAAG,IACV,EACA,CACF,EACA,OAAIH,EAAO,aAAa,QAAQ,IAAIE,EAAU,CAAE,MAAO,IAAK,CAAC,EACtDA,CACR,CACA,OAAIF,EAAO,aAAa,QAAQ,IAAI,SAAUC,CAAM,EAC7C,CAAE,QAASA,EAAO,QAAS,KAAMA,EAAO,IAAK,CACrD,ECpBA,IAAAG,EAAc,kBAERC,EAA0B,EAAAC,QAAE,OAAO,CACxC,UAAW,EAAAA,QAAE,OAAO,EAAE,KAAK,EAAE,SAAS,EACtC,SAAU,EAAAA,QAAE,OAAO,EAAE,KAAK,EAAE,SAAS,sBAAsB,EAAE,IAAI,GAAI,2CAA2C,EAChH,KAAM,EAAAA,QAAE,OAAO,EAAE,KAAK,EAAE,SAAS,kBAAkB,EAAE,IAAI,GAAI,uCAAuC,EACpG,UAAW,EAAAA,QAAE,OAAO,EAAE,SAAS,EAC/B,OAAQ,EAAAA,QAAE,OAAO,EAAE,SAAS,EAC5B,YAAa,EAAAA,QAAE,QAAQ,EAAE,QAAQ,EAAK,EAAE,SAAS,CAClD,CAAC,EAGKC,EAAoBF,EAAwB,OAAO,CACxD,KAAM,EAAAC,QAAE,QAAQ,YAAY,EAC5B,cAAe,EAAAA,QAAE,QAAQ,MAAM,EAAE,SAAS,EAC1C,eAAgB,EAAAA,QAAE,KAAK,CAAC,MAAO,QAAQ,CAAC,EAAE,SAAS,CACpD,CAAC,EAGKE,EAAoBH,EAAwB,OAAO,CACxD,KAAM,EAAAC,QAAE,QAAQ,YAAY,EAC5B,cAAe,EAAAA,QAAE,KAAK,CAAC,MAAO,QAAQ,CAAC,EAAE,SAAS,EAClD,eAAgB,EAAAA,QAAE,QAAQ,MAAM,EAAE,SAAS,CAC5C,CAAC,EAGKG,EAA4B,EAAAH,QAAE,mBAAmB,OAAQ,CAACC,EAAmBC,CAAiB,CAAC,EFf9F,SAASE,EAAQC,EAAiBC,EAAoD,CAC5F,GAAI,CAEH,IAAMC,EAAgBC,EAAAC,EAAA,GAClBH,GADkB,CAErB,KAAM,YACP,GAOA,GAAI,CALYI,EAAe,CAC9B,OAAQC,EACR,QAASJ,EACT,YAAaA,EAAc,WAC5B,CAAC,EACY,QAAS,MAAM,IAAI,MAAM,qCAAqC,EAE3E,IAAMK,EAAYL,EAAc,WAAa,cACvCM,EAAgBN,EAAc,eAAiB,OAC/CO,EAAiBP,EAAc,gBAAkB,MACjDQ,EAAYR,EAAc,WAAa,GACvCS,EAAST,EAAc,QAAU,GAEjCU,KAAM,cAAWV,EAAc,SAAUA,EAAc,KAAMQ,CAAS,EACtEG,KAAK,eAAYF,CAAM,EAEvBG,KAAS,kBAAeP,EAAWK,EAAKC,CAAE,EAC5CE,EAAYD,EAAO,OAAOd,EAASQ,EAAeC,CAAc,EACpE,OAAAM,GAAaD,EAAO,MAAML,CAAc,EAEjC,CACN,QAAS,yBACT,GAAII,EAAG,SAASJ,CAAc,EAC9B,MAAOM,CACR,CACD,OAASC,EAAK,CACb,IAAMC,EAAUD,aAAe,MAAQ,yBAAyBA,EAAI,OAAO,GAAK,gBAChF,cAAQ,MAAMC,CAAO,EACf,IAAI,MAAMA,CAAO,CACxB,CACD,CAEO,SAASC,EAAQlB,EAAiBa,EAAYZ,EAAiC,CACrF,GAAI,CAEH,IAAMC,EAAgBC,EAAAC,EAAA,GAClBH,GADkB,CAErB,KAAM,YACP,GAQA,GAAI,CALYI,EAAe,CAC9B,OAAQC,EACR,QAASJ,EACT,YAAaA,EAAc,WAC5B,CAAC,EACY,QAAS,MAAM,IAAI,MAAM,qCAAqC,EAE3E,IAAMK,EAAYL,EAAc,WAAa,cACvCiB,EAAWjB,EAAc,SACzBkB,EAAOlB,EAAc,KACrBQ,EAAYR,EAAc,WAAa,GACvCM,EAAgBN,EAAc,eAAiB,MAC/CO,EAAiBP,EAAc,gBAAkB,OAEjDU,KAAM,cAAWO,EAAUC,EAAMV,CAAS,EAC1CW,EAAa,OAAO,KAAKR,EAAIL,CAAa,EAE1Cc,KAAW,oBAAiBf,EAAWK,EAAKS,CAAU,EACxDE,EAAYD,EAAS,OAAOtB,EAASQ,EAAeC,CAAc,EACtE,OAAAc,GAAaD,EAAS,MAAMb,CAAc,EAEnCc,CACR,OAASP,EAAK,CACb,IAAMC,EACLD,aAAe,MACZ,sDAAsDA,EAAI,OAAO,GACjE,gBACJ,cAAQ,MAAMC,CAAO,EACf,IAAI,MAAMA,CAAO,CACxB,CACD","names":["app_exports","__export","decrypt","encrypt","__toCommonJS","import_crypto","isValidPayload","params","result","errorObj","el","import_zod","BaseCryptographyOptions","z","EncryptionOptions","DecryptionOptions","CryptographyOptionsSchema","encrypt","payload","options","mergedOptions","__spreadProps","__spreadValues","isValidPayload","CryptographyOptionsSchema","algorithm","encodingInput","encodingOutput","keyLength","ivSize","key","iv","cipher","encrypted","err","message","decrypt","password","salt","bufferedIv","decipher","decrypted"]}